@section styles {
    <link rel="stylesheet" href="~/Content/Css/Cart.css" />
}

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giỏ hàng - SuperSports</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

</head>
<body>
    <main class="container">
        <div class="breadcrumb">
            <a href="#">Trang chủ</a> > <a href="#">Giỏ hàng</a>
        </div>
    </main>

    <main class="container">

        <!-- Cart Items Section -->
        <div class="cart-items">
            <div id="cartItems">
                <!-- Cart items will be rendered here -->
            </div>
        </div>

        <!-- Cart Summary Section -->
        <div class="cart-summary">
            <div class="voucher-banner">
                <a href="@Url.Action("Register_Login","Home")"><h3>ĐĂNG KÝ NGAY | NHẬN NGAY</h3>
                <p>VOUCHER 150.000 VND CHO ĐƠN HÀNG ĐẦU TIÊN</p></a>
            </div>

            <div class="summary-row">
                <span id="itemCount">(0) sản phẩm</span>
                <span id="subtotal">0₫</span>
            </div>

            <div class="summary-row">
                <span>Giảm giá</span>
                <span>Áp dụng tại trang thanh toán</span>
            </div>

            <div class="summary-row">
                <span>Phí vận chuyển</span>
                <span>Miễn phí</span>
            </div>

            <div class="summary-row total">
                <span>Thành tiền:</span>
                <span id="totalAmount">0₫</span>
            </div>

            <p class="note">*Phí ship và coupon áp dụng tại trang thanh toán</p>

            <button class="checkout-btn" onclick="checkout()">
                THANH TOÁN
            </button>

            <div class="payment-methods">
                <p>Thanh toán nhanh chóng với:</p>
                <div class="payment-icons">
                    <div class="payment-icon">VNPay</div>
                    <div class="payment-icon">Momo</div>
                    <div class="payment-icon">ZaloPay</div>
                    <div class="payment-icon">Credit</div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Sample product data matching the image
        const sampleProduct = {
            id: 1,
            brand: "NIKE",
            name: "Giày Chạy Bộ Nữ Nike Vomero 18",
            variant: "XANH MINT / US 6",
            price: 4259000,
            image: "https://via.placeholder.com/300x300/87CEEB/FFFFFF?text=Nike+Vomero+18",
            color: "Xanh Mint",
            size: "US 6",
            qty: 1
        };

        // Initialize cart
        document.addEventListener("DOMContentLoaded", function () {
            let cart = JSON.parse(localStorage.getItem("cart")) || [];

            // If cart is empty, add sample product for demo
            if (cart.length === 0) {
                cart.push({ ...sampleProduct });
                localStorage.setItem("cart", JSON.stringify(cart));
            }

            renderCart();
        });

        function renderCart() {
            const cart = JSON.parse(localStorage.getItem("cart")) || [];
            const container = document.getElementById("cartItems");
            const itemCountEl = document.getElementById("itemCount");
            const subtotalEl = document.getElementById("subtotal");
            const totalEl = document.getElementById("totalAmount");

            if (cart.length === 0) {
                container.innerHTML = `
                                        <div style="text-align: center; padding: 40px;">
                                            <i class="fas fa-shopping-cart" style="font-size: 60px; color: #ddd; margin-bottom: 20px;"></i>
                                            <h3>Giỏ hàng trống</h3>
                                            <p>Hãy thêm sản phẩm vào giỏ hàng</p>
                                        </div>
                                    `;
                itemCountEl.textContent = "(0) sản phẩm";
                subtotalEl.textContent = "0₫";
                totalEl.textContent = "0₫";
                return;
            }

            let html = "";
            let totalItems = 0;
            let subtotal = 0;

            cart.forEach((item, index) => {
                totalItems += item.qty;
                const itemTotal = item.qty * item.price;
                subtotal += itemTotal;

                html += `
                                    <div class="cart-item">
                                        <img src="${item.image}" alt="${item.name}" class="item-image">
                                        <div class="item-details">
                                            <div class="brand">${item.brand}</div>
                                            <div class="item-name">${item.name}</div>
                                            <div class="item-variant">${item.variant}</div>
                                            <div class="item-price">${item.price.toLocaleString()}₫</div>

                                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                                <div class="quantity-controls">
                                                    <button class="qty-btn" onclick="changeQuantity(${index}, -1)">-</button>
                                                    <span class="qty-display">${item.qty}</span>
                                                    <button class="qty-btn" onclick="changeQuantity(${index}, 1)">+</button>
                                                </div>
                                                <div class="item-total">${itemTotal.toLocaleString()}₫</div>
                                            </div>

                                            <button class="remove-btn" onclick="removeItem(${index})">
                                                <i class="fas fa-trash"></i> Xóa
                                            </button>
                                        </div>
                                    </div>`;
            });

            container.innerHTML = html;
            itemCountEl.textContent = `(${totalItems}) sản phẩm`;
            subtotalEl.textContent = `${subtotal.toLocaleString()}₫`;
            totalEl.textContent = `${subtotal.toLocaleString()}₫`;
        }

        function changeQuantity(index, change) {
            let cart = JSON.parse(localStorage.getItem("cart")) || [];

            if (cart[index]) {
                cart[index].qty += change;

                // Ensure quantity doesn't go below 1
                if (cart[index].qty < 1) {
                    if (confirm("Bạn có muốn xóa sản phẩm này khỏi giỏ hàng?")) {
                        cart.splice(index, 1);
                    } else {
                        cart[index].qty = 1;
                    }
                }

                localStorage.setItem("cart", JSON.stringify(cart));
                renderCart();
            }
        }

        function removeItem(index) {
            if (confirm("Bạn có chắc muốn xóa sản phẩm này khỏi giỏ hàng?")) {
                let cart = JSON.parse(localStorage.getItem("cart")) || [];
                cart.splice(index, 1);
                localStorage.setItem("cart", JSON.stringify(cart));
                renderCart();
            }
        }

        function checkout() {
            const cart = JSON.parse(localStorage.getItem("cart")) || [];

            if (cart.length === 0) {
                alert("Giỏ hàng của bạn đang trống!");
                return;
            }

            // Calculate total
            const total = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);

            window.location.href = '@Url.Action("DeliverLocate", "Home")';
        }

        // Function to add new product to cart (for demo purposes)
        function addSampleProduct() {
            let cart = JSON.parse(localStorage.getItem("cart")) || [];

            const newProduct = {
                id: Date.now(), // Unique ID
                brand: "ADIDAS",
                name: "Giày Chạy Bộ Nam Adidas Ultraboost",
                variant: "ĐEN / US 9",
                price: 2400000,
                image: "https://via.placeholder.com/300x300/333333/FFFFFF?text=Adidas+Ultraboost",
                color: "Đen",
                size: "US 9",
                qty: 1
            };

            cart.push(newProduct);
            localStorage.setItem("cart", JSON.stringify(cart));
            renderCart();

            alert("Đã thêm sản phẩm mới vào giỏ hàng!");
        }
    </script>

    <!-- Demo button to add more products -->
    <div style="position: fixed; bottom: 20px; right: 20px;">
        <button onclick="addSampleProduct()" style="
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        ">
            <i class="fas fa-plus"></i> Thêm SP Mẫu
        </button>
    </div>
</body>
</html>
